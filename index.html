<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Archaeological Seal Map</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

  <style>
    body { margin:0; }
    #map { height: 100vh; }

    .seal-marker {
      width:32px;
      height:32px;
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      color:white;
      font-weight:bold;
      font-size:14px;
      border:2px solid white;
    }

    .popup-content {
        max-height: 100px;
     overflow-y: auto;
     padding-right: 5px;
     }

    .popup-images img {
        width: 150px;
     margin-bottom: 10px;
        display: block;
    }
  </style>
</head>

<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>

// ============================
// 1️⃣ CREATE MAP
// ============================

var map = L.map('map', {
  crs: L.CRS.Simple,
  minZoom: -2
});

// Your image dimensions (HEIGHT first, WIDTH second)
var bounds = [[0,0], [1912,2940]];

var image = L.imageOverlay('site_map.jpg', bounds).addTo(map);
map.fitBounds(bounds);


// ============================
// 2️⃣ COLOR FUNCTION
// ============================

function getColor(type) {
  if (type === "Blue") return "#1f78b4";
  if (type === "Red") return "#e31a1c";
  if (type === "Green") return "#33a02c";
  return "#6a3d9a"; // default color
}


// seal data w/ room info and color grouping

var seals = [

  // human depictions
  { id: "JA395", room: "S64", type: "Blue", coords: [950, 1400], image: "images/ja395.jpg" },
  { id: "JA396", room: "S64", type: "Blue", coords: [950, 1400], image: "images/ja396.jpg" },
  { id: "JA249", room: "S36", type: "Blue", coords: [950, 1400], image: "images/ja249.jpg" },
  { id: "JA309", room: "S36", type: "Blue", coords: [950, 1400], image: "images/ja309.jpg" },
  { id: "JA312", room: "S36", type: "Blue", coords: [900, 1400], image: "images/ja312.jpg" },
  { id: "JA246", room: "S36", type: "Blue", coords: [900, 1400], image: "images/ja246.jpg" },
  { id: "JA536", room: "S69", type: "Blue", coords: [900, 1400], image: "images/ja536.jpg" },
  { id: "JA513", room: "S69", type: "Blue", coords: [900, 1400], image: "images/ja513.jpg" },
  { id: "JA269", room: "S36", type: "Blue", coords: [900, 1400], image: "images/ja269.jpg" },

  // caprids
  { id: "JA245", room: "S36", type: "Red", coords: [900, 1400], image: "images/ja245.jpg" },
  { id: "JA279", room: "S36", type: "Red", coords: [900, 1400], image: "images/ja279.jpg" },
  { id: "JA263", room: "S36", type: "Red", coords: [900, 1400], image: "images/ja263.jpg" },


    // other? 
    { id: "JA253", room: "S36", type: "Green", coords: [900, 1400], image: "images/ja253.jpg" }

];



// grouping by room etc


var grouped = {};

seals.forEach(function(seal) {

  var key = seal.room + "_" + seal.type;

  if (!grouped[key]) {
    grouped[key] = {
      room: seal.room,
      type: seal.type,
      coords: seal.coords,
      seals: []
    };
  }
// maybe change above – require just r #? 
  grouped[key].seals.push(seal);
});



// point markers  

Object.values(grouped).forEach(function(group) {

  var count = group.seals.length;

  var marker = L.marker(group.coords, {
    icon: L.divIcon({
      className: '',
      html: `
        <div class="seal-marker" style="background:${getColor(group.type)}">
          ${count}
        </div>
      `,
      iconSize: [32, 32],
      iconAnchor: [16, 16]
    })
  }).addTo(map);


  //  popup
  var popupContent = `
  <div style="width:220px;">
    <strong>${group.room}</strong><br>
    Type: ${group.type}<br>
    Total: ${count}<br><br>
    <div class="popup-content popup-images">
`;

group.seals.forEach(function(seal) {
  popupContent += `
    <strong>${seal.id}</strong><br>
    <img src="${seal.image}">
  `;
});

popupContent += `
    </div>
  </div>
`;

  group.seals.forEach(function(seal) {
    popupContent += `
      <strong>${seal.id}</strong><br>
      <img src="${seal.image}">
    `;
  });

  popupContent += "</div>";

  marker.bindPopup(popupContent);

});


// ============================
// 6️⃣ OPTIONAL: CLICK MAP TO GET COORDS
// (Remove after you're done)
// ============================

map.on('click', function(e) {
  console.log(e.latlng);
});

</script>

</body>
</html>